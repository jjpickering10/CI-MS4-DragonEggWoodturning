{% extends 'base.html' %}
{% load static %}

{% block content %}

{% if bag_items %}
<div class="col s12 m7">
    <h2 class="header">Horizontal Card</h2>
    <div class="card horizontal">
      <div class="card-image">
        <img src="https://lorempixel.com/100/190/nature/6">
      </div>
      <div class="card-stacked">
        <div class="card-content">
        {% for item in bag_items %}
          <p>Name: {{ item.product.name }}</p>
          <p>Price per item: £{{ item.product.price }}</p>
          <p>Quantity: {{ item.quantity }}</p>
          <form action="{% url 'remove_from_bag' item.item_id %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="Remove">
        </form>
        {% endfor %}
        </div>
        <div class="card-action">
            <p>Total: {{ total|floatformat:2 }}</p>
            <p>Delivery: {{ delivery|floatformat:2 }}</p>
            <p>Grand Total: {{ grand_total|floatformat:2 }}</p>
            {% if free_delivery_delta > 0 %}
            <p>For free delivery, spend £{{ free_delivery_delta }} extra!</p>
            {% endif %}
          <a href="#">Keep Shopping</a>
          <a href="{% url 'checkout' %}">Secure Checkout</a>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <p>Your bag is empty</p>
  {% endif %}

<div class="bag-container">
  <div class="bag-table">
    {% if bag_items %}
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Total</th>
          </tr>
        </thead>
  
        {% for item in bag_items %}
        <tbody>
          <tr>
            <td class="product-td">{{ item.product.name }}
              {% if item.product.image_set.all|length > 0 %}
              <img src="{{ item.product.image_set.first.image.url }}" alt="">
            {% else %}
              <img src="{{ MEDIA_URL }}noimage.png">
            {% endif %}
            </td>
            <td>£{{ item.product.price }}</td>
            <td>{{ item.quantity }}</td>
            <td></td>
          </tr>
        </tbody>
        {% endfor %}
        <thead>
          <tr>
            <th>Subtotal</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ grand_total|floatformat:2 }}</td>
          </tr>
        </tbody>
        
      </table>
      <div class="bag-subtotal">
        <div>
          <h5>Subtotal: <span>£{{ grand_total|floatformat:2 }}</span></h5>
          <p>Delivery: <span>£{{ delivery|floatformat:2 }}</span></p>
        </div>
        <div class="bag-buttons">
          <a class="global-button" href="#">Keep Shopping</a>
          <a class="global-button" href="{% url 'checkout' %}">Secure Checkout</a>
        </div>
      </div>
      {% endif %}
  </div>
</div>

  {% endblock %}